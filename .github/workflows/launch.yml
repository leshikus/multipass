name: Multipass image instance test
on:
  workflow_call:
    inputs:
      name:
        type: string
        default: None

jobs:
  build:
    name: ${{ inputs.name }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - run: |
          set -vx
          sudo snap install multipass
          sudo snap restart multipass.multipassd
          ls -l /var/snap/multipass/common/multipass_socket || true
          journalctl --unit 'snap.multipass*'
          sudo snap connections multipass
          sudo cat /var/log/syslog
          multipass launch -n instance ${{ inputs.name }}
          multipass exec instance cat /etc/pollinate/add-user-agent

